# Network
## Содержание
1. [CORS](#cors)
    - [Принцип работы](#принцип-работы)
    - [Заголовки](#заголовки)
2. CSRF
3. REST
4. [JSONP](#jsonp)
    - [Особенности JSONP](#особенности-jsonp)
5. AJAX

## CORS
**CORS** или **Cross-Origin Resource Sharing** - технология современных браузеров, которая предоставляет веб-странице доступ к ресурсам другого домена (через cross-доменные запросы). По умолчанию сайты ограничиваются доступом к ресурсам того же домена (**Same Origin Policy**), потому что браузер не разрешает AJAX-запросы к другим сайтам.

Спецификация CORS определяет ряд заголовков, которые помогают браузеру и серверу понять, какие междоменные запросы разрешены, а какие нет. CORS является техникой, которая позволяет веб-странице обрабатывать REST-запросы от другого источника.

Стандарт CORS определяет **простые** и **сложные** запросы. *Простыми запросами являются те, у которых:*
- **Тип запроса**: GET, POST, HEAD **и**
- **Заголовки**:
    - Accept
    - Accept-Language
    - Content-Language
    - Last-Event-ID
    - Content-Type со значениями:
        - application/x-www-form-urlencoded
        - multipart/form-data
        - text/plain

### Принцип работы

Если запрос является **простым**, то можно слать AJAX к другому сайту. При этом браузер добавит заголовок *Origin*. Подделать заголовок в коде не получится. Сервер, получив такой запрос, должен решить, как его обрабатывать.

Пример CORS-запроса:
```
POST /foo/bar HTTP/1.1
Origin: http://foreign.com
Host: test.com
```

и ответа с разрешением на получение данных:
```
200 OK HTTP/1.1
Access-Control-Allow-Origin: http://foreign.com
Content-Type: text/html; charset=utf-8

<h1>Welldone</h1>
```

Как правило, CORS необходим для того, чтобы работать с API. С очень большой вероятностью API работает с JSON, то есть *Content-Type=application/json*, а это значит, что запрос является **сложным**. В этом случае бразур сначала делает **preflight-запрос** с помощью метода *OPTIONS*. Сервер должен ответить, какими методами и с каких доменов разрешено обращаться к ресурсам. Далее браузер сравнит то, что пришло в ответе с исходным запросом и решит, блокировать его или нет.

### Заголовки

Кроме *Access-Control-Allow-Origin* есть и другие заголовки, которые участвуют в разшерении доступа к ресурсам.

1. **Access-Control-Allow-Origin** - указывает, какие домены могут обращаться к ресурсам сайта
2. **Access-Control-Allow-Methods** - указывает, какие методы разрешены при обращении к ресурсам сайта
3. **Access-Control-Max-Age** - указывает время жизни preflight-запроса.

## JSONP

*JSONP* или *JSON with Padding* (JSON с обвязкой) необходим для осуществления кросс-доменных запросов. Основан на том, что не запрещено встаивать в страницу ресурсы с других доменов, например:
```
<script href="http://example.com/script.js"></script>
```
В этом случае браузер выполнит всё, что внутри script.js.

Можно предположить, что сервер отдаёт не статичный js-файл, а динамически создаёт его в зависимости от переданных параметров. Так, например, мы можем передать эти самые параметры:
```
<script href="http://example.com/script.js?method=getUser&userId=1"></script>
```
В этом случае сервер может вернуть json объект:
```
{
    userId: 1,
    name: "User"
}
```
Но этот объект просто считается в память и ничего не произойдёт, именно поэтому передают ещё один параметр - **callback** (функция, которая выполнится на клиенте), то есть ответ от сервера будет таким:
```
callback({
    userId: 1,
    name: "User"
})
```
На клиенте отработает код функции *callback*.

### Особенности JSONP

- Работает только с **GET**-запросами
- Добавив скрипт на страницу, невозможно будет узнать статус загрузки скрипта или факт возникновения ошибки.

