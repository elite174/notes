# Браузер
##  Рендер страницы
### Этапы рендера страницы

1) Формирование **DOM** из полученного HTML документа
2) Загрузка стилей CSS и формирование **CSSDOM**
3) Используя DOM и CSSDOM браузер выстраивает **render tree** (набор объектов рендеринга). Render tree дублирует структуру DOM, но с некоторыми отличиями:
	- В него не попадают невидимые элементы (например, head или элементы с display: none)
	- Каждая строка текста представлена в виде отдельного renderer
	
	Каждый объект renderer содержит в себе соответствующий объект DOM (или текст), а также рассчитанные стили. 
4) Для каждого объекта в render tree происходит рассчёт положения на странице (**layout**). Браузеры используют поточный метод *flow*, с помощью которого в большинстве случаев достаточно одного прохода по дереву для определения положения (для таблиц, обычно, нужно больше проходов).
5) Завершающий этап - отрисовка или **painting**.

В процессе взаимодействия пользователя со страницей (например, при изменении стилей или js-манипуляциях), некоторые этапы приходится запускать заново:

1) В случаях, когда положение элемента на странице не меняется (например, изменяются такие css-стили как: border-color, visibility, background-color...) выполняется **repaint** (т. е. браузер отрисует его заново без пересчёта позиции и прочего).
2) Когда же происходит изменение структуры документа, положение элементов, то происходит **reflow**.

### Оптимизации рендера

1) **Локализация изменений**
Браузеры локализуют **repaint** и **reflow** в пределах изменённых элементов. Например, при изменении абсолютно или фиксировано спозиционированного элемента браузер затронет только элемент и его потомков, а при изменении статично спозиционированного элемента - весь документ.
2) **Кэширование изменений**
Браузер старается кэшировать изменения, которые происходят в js-коде, и применять их в один проход после завершения исполнения блока кода. 
```
var $body = $('body');
$body.css('padding', '1px'); // reflow, repaint
$body.css('color', 'red'); // repaint
$body.css('margin', '2px'); // reflow, repaint
// На самом деле произойдет только 1 reflow и repaint
```
Однако, как описано выше, обращение к свойствам элементов вызовет принудительный reflow. То есть, если мы в приведённый блок кода добавим обращение к свойству элемента, это вызовет лишний reflow:
```
var $body = $('body');
$body.css('padding', '1px');
$body.css('padding'); // обращение к свойству, принудительный reflow
$body.css('color', 'red');
$body.css('margin', '2px');
```
